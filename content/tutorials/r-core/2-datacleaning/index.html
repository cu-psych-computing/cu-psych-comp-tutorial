---
title: "Data Cleaning"
author: "Ellen Tedeschi"
subtitle: "CU Psych Scientific Computing Workshop"
tags: ["core", "R"]
weight: 200
---

<script src="/rmarkdown-libs/accessible-code-block/empty-anchor.js"></script>
<link href="/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<div id="goals-of-this-lesson" class="section level1">
<h1>Goals of This Lesson</h1>
<p>Students will learn:</p>
<ol style="list-style-type: decimal">
<li>How to open various data types in R</li>
<li>How to check for missing or problematic data and address issues.</li>
<li>How to filter, rearrange and shape data in preparation for analysis.</li>
</ol>
</div>
<div id="links-to-files-and-video-recording" class="section level1">
<h1>Links to Files and Video Recording</h1>
<p>The files for all tutorials can be downloaded from <a href="https://github.com/cu-psych-computing/cu-psych-comp-tutorial" target="_blank">the Columbia Psychology Scientific Computing GitHub page</a> using <a href="/accessing-files/" target="_blank">these instructions</a>. This particular file is located here: <code>/content/tutorials/r-core/2-datacleaning/index.rmd</code>.</p>
<p>For a video recording of this tutorial from the Fall 2020 workshop, please visit the <a href="/workshop-recording/session2/" target="_blank">Workshop Recording: Session 2</a> page.</p>
</div>
<div id="install-packages" class="section level1">
<h1>Install Packages</h1>
<p><code>tidyverse</code> is one package with many tools. Although you first encountered it in the Programming lessons, we will introduce this package further in this lesson, and will continue using <code>tidyverse</code> in the modules to come.</p>
</div>
<div id="getting-your-data-into-r" class="section level1">
<h1>Getting Your Data into R</h1>
<div id="entering-data-directly" class="section level2">
<h2>Entering data directly</h2>
<p>In some cases, you may want to enter data directly into R. This is easy with a small number of cases.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Direct Data Entry</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>dataframe &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;Monica&quot;</span>, <span class="st">&quot;Michelle&quot;</span>, <span class="st">&quot;Paul&quot;</span>, <span class="st">&quot;Ellen&quot;</span>),</span>
<span id="cb1-3"><a href="#cb1-3"></a>                    <span class="dt">score =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">16</span>, <span class="dv">35</span>, <span class="dv">19</span>),</span>
<span id="cb1-4"><a href="#cb1-4"></a>                    <span class="dt">year =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<p>However, it’s easy to introduce errors this way, and with a lot of data it would get tedious.</p>
</div>
<div id="reading-data-into-r" class="section level2">
<h2>Reading data into R</h2>
<p>Most of the time, you’ll be reading data from an external file (e.g., .txt or .csv), or opening up an existing dataset in R. Once you find the location of your files, what you do next will depend on the file format.</p>
<div id="whats-your-working-directory-and-where-is-the-file-you-want" class="section level3">
<h3>What’s your working directory and where is the file you want?</h3>
<p>Your working directory is the directory (and subdirectories) where the files you’re working with are stored. Whenever possible, you should open the files you run in R from a .Rproj link; by doing so, the folder in which that file was located will automatically be your working directory.</p>
<p>You can check your working directory using the <code>here()</code> function.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">here</span>()</span></code></pre></div>
<pre><code>## [1] &quot;/Users/emily/Documents/GitHub/cu-psych-comp-tutorial&quot;</code></pre>
<p>You can access a list of the files within your working directory using the <code>list.files()</code> function…</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">list.files</span>(<span class="kw">here</span>())</span></code></pre></div>
<pre><code>##  [1] &quot;_output.yml&quot;                  &quot;blogdown&quot;                    
##  [3] &quot;config.toml&quot;                  &quot;content&quot;                     
##  [5] &quot;cu-psych-comp-tutorial.Rproj&quot; &quot;index.Rmd&quot;                   
##  [7] &quot;public&quot;                       &quot;README.md&quot;                   
##  [9] &quot;static&quot;                       &quot;themes&quot;</code></pre>
<p>…as well as in the “Files” tab in the module at the bottom right corner of your RStudio window.</p>
</div>
<div id="what-kind-of-file-do-you-have" class="section level3">
<h3>What kind of file do you have?</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">## To load .csv files</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>mydata &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">here</span>(<span class="st">&quot;content&quot;</span>, <span class="st">&quot;tutorials&quot;</span>, <span class="st">&quot;r-core&quot;</span>, <span class="st">&quot;2-dataCleaning&quot;</span>, <span class="st">&quot;Study1.csv&quot;</span>))</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   ID = col_double(),
##   Age = col_double(),
##   Sex = col_character(),
##   Condition = col_double(),
##   Personality = col_double(),
##   T1 = col_double(),
##   T2 = col_double(),
##   T3 = col_double(),
##   T4 = col_double()
## )</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Other options include:</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co"># read_tsv, for tab-delimited files</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co"># read_delim, for when you have a separator that&#39;s not standard</span></span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">## To load data that&#39;s already in an R format</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="kw">load</span>(<span class="kw">here</span>(<span class="st">&quot;content&quot;</span>, <span class="st">&quot;tutorials&quot;</span>, <span class="st">&quot;r-core&quot;</span>, <span class="st">&quot;2-dataCleaning&quot;</span>, <span class="st">&quot;Study1.rda&quot;</span>))</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">## To load data from Excel (.xlsx, .xls):</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co"># install.packages(&quot;readxl&quot;)</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co"># library(readxl)</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co"># read_excel(&lt;Path to file&gt;)</span></span>
<span id="cb8-12"><a href="#cb8-12"></a></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">## To load data from many other programs (e.g., SPSS, SAS, Stata, and more):</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co"># install.packages(&quot;foreign&quot;)</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co"># library(foreign)</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co"># read.spss(&lt;Path to file&gt;)</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co"># read.dta(&lt;Path to file&gt;)</span></span></code></pre></div>
<p>Remember, all of these commands can have arguments that will help R make sense of your data. To find out what arguments are possible, put a question mark in front of the name of the function (e.g. <code>?read.table</code>). For options not listed here, Google “<your data type> into R” and you should find instructions.</p>
</div>
</div>
</div>
<div id="inspecting-your-data" class="section level1">
<h1>Inspecting Your Data</h1>
<p>Now you have data, it’s time to get some results! But wait! Are you sure this data is ok? Performing some basic steps to inspect your data now can save you lots of headaches later, and R makes it really easy.</p>
<p>Start by checking that you have the expected number of rows and columns in your data frame. You can do this by looking at the Environment window, or by asking R.</p>
<div id="how-is-your-data-frame-structured" class="section level2">
<h2>How is your data frame structured?</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Number of rows and number of columns</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>numberSubjects &lt;-<span class="st"> </span><span class="kw">nrow</span>(mydata)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw">ncol</span>(mydata)</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Names of columns</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">names</span>(mydata)</span></code></pre></div>
<pre><code>## [1] &quot;ID&quot;          &quot;Age&quot;         &quot;Sex&quot;         &quot;Condition&quot;   &quot;Personality&quot;
## [6] &quot;T1&quot;          &quot;T2&quot;          &quot;T3&quot;          &quot;T4&quot;</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># look at the first few rows</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>mydata</span></code></pre></div>
<pre><code>## # A tibble: 50 x 9
##       ID   Age Sex    Condition Personality    T1    T2    T3    T4
##    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1    21 Female         0          67     5     2     3     1
##  2     2    22 Female         1          63     4     1     5     2
##  3     3    24 Male           1          58     6     2     6     2
##  4     4    22 Female         1          51     2     3     6     5
##  5     5    19 Female         0          49     7     6     5     2
##  6     6    25 Female         1          45     6     3     6     5
##  7     7    24 Female         1          68     7     1     4     6
##  8     8    19 Male           1          58     4     7     3     4
##  9     9    21 Male           1          56     3     4     7     2
## 10    10    20 Female         0          74     6     1     6     2
## # … with 40 more rows</code></pre>
</div>
<div id="brief-intro-to-tidyverse" class="section level2">
<h2>Brief intro to <code>tidyverse</code></h2>
<p><code>tidyverse</code> is not one package; instead, it’s multiple packages grouped together. They’re all made by the same developers, so the functions play nicely together. If you’ve worked in R before, there are some packages that you’re probably familiar with, like <code>ggplot2</code> and <code>dplyr</code>, as well as others that are more obscure. These are all very useful packages, but they do have some <code>tidyverse</code>-specific syntax that we’ll be using. (Note: The following paragraphs are taken almost verbatim from <a href="/tutorials/r-extra/tidyverse-guide/tidyguide-1/">our standalone <code>tidyverse</code> tutorial</a>).</p>
<p>Enter the pipe <code>%&gt;%</code>! The pipe does one simple, but key, thing: <strong>takes the object on the left-hand side and feeds it into the first argument of the function on the right-hand side.</strong> This means that:</p>
<ul>
<li><code>a %&gt;% foo()</code> is equivalent to <code>foo(a)</code>. Fine and good.</li>
<li><code>a %&gt;% foo() %&gt;% bar(arg = TRUE)</code> is equivalent to <code>bar(foo(a), arg = TRUE)</code>. Now, nested function calls read left-to-right!</li>
<li>Most common use case: <code>df_new &lt;- df_old %&gt;% foo() %&gt;% bar(arg = TRUE) %&gt;% baz()</code> is equivalent to <code>df_new &lt;- baz(bar(foo(df_old), arg = TRUE))</code>. Now, you can chain a series of preprocessing commands to operate on a dataframe all at once, and easily read those commands as typed in your script. No more accidentally not running some key preprocessing command that causes later code to break!</li>
</ul>
<p>Note that #pipelife requires functions to:</p>
<ul>
<li>take as their first argument the object to be operated upon</li>
<li>return the same object (or an analog of said), but now operated upon</li>
</ul>
<p>Essentially all functions from the <code>tidyverse</code> are pipe-safe (including the <code>mutate()</code> and <code>summarize()</code> functions covered in the <a href="/tutorials/r-core/1-programming/lessonpart1/">Programming, Part 1</a> tutorial and the <code>filter()</code> function covered in the <a href="/tutorials/r-core/1-programming/lessonpart2/">Programming, Part 2</a> tutorial), but bear this in mind when trying to incorporate functions from base R or other packages into your tidy new world.</p>
</div>
<div id="renaming-a-variable" class="section level2">
<h2>Renaming a variable</h2>
<p>We’ll demonstrate the <code>%&gt;%</code> command for our first cleaning step. Look back at your <code>mydata</code> data frame. What is that fifth variable? What does that even mean? Luckily, this is your study and you know that it’s a personality questionnaire measuring neuroticism. Let’s fix that using <code>recode()</code> from the <code>dplyr</code> package.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Simple command with no pipe, commented out so we don&#39;t run both.</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co"># mydata &lt;- rename(mydata, Neuroticism=Personality) ## NewVariableName = OldVariableName</span></span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co"># Simple command with pipe</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>mydata &lt;-<span class="st"> </span>mydata <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">Neuroticism=</span>Personality) </span>
<span id="cb15-7"><a href="#cb15-7"></a></span>
<span id="cb15-8"><a href="#cb15-8"></a>mydata</span></code></pre></div>
<pre><code>## # A tibble: 50 x 9
##       ID   Age Sex    Condition Neuroticism    T1    T2    T3    T4
##    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1    21 Female         0          67     5     2     3     1
##  2     2    22 Female         1          63     4     1     5     2
##  3     3    24 Male           1          58     6     2     6     2
##  4     4    22 Female         1          51     2     3     6     5
##  5     5    19 Female         0          49     7     6     5     2
##  6     6    25 Female         1          45     6     3     6     5
##  7     7    24 Female         1          68     7     1     4     6
##  8     8    19 Male           1          58     4     7     3     4
##  9     9    21 Male           1          56     3     4     7     2
## 10    10    20 Female         0          74     6     1     6     2
## # … with 40 more rows</code></pre>
<p>It might seem like the first version is simpler, but it won’t be once you start stacking functions together. For example, let’s rearrange our variables (using <code>select()</code>) while also renaming the variables called T1, T2, T3, and T4. Note that we keep adding <code>%&gt;%</code> between each set of functions.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>mydata &lt;-<span class="st"> </span>mydata <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">Day1 =</span> T1, <span class="dt">Day2 =</span> T2, <span class="dt">Day3 =</span> T3, <span class="dt">Day4 =</span> T4) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="st">  </span><span class="kw">select</span>(ID, Condition, Age, <span class="kw">everything</span>())</span>
<span id="cb17-4"><a href="#cb17-4"></a>mydata</span></code></pre></div>
<pre><code>## # A tibble: 50 x 9
##       ID Condition   Age Sex    Neuroticism  Day1  Day2  Day3  Day4
##    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1         0    21 Female          67     5     2     3     1
##  2     2         1    22 Female          63     4     1     5     2
##  3     3         1    24 Male            58     6     2     6     2
##  4     4         1    22 Female          51     2     3     6     5
##  5     5         0    19 Female          49     7     6     5     2
##  6     6         1    25 Female          45     6     3     6     5
##  7     7         1    24 Female          68     7     1     4     6
##  8     8         1    19 Male            58     4     7     3     4
##  9     9         1    21 Male            56     3     4     7     2
## 10    10         0    20 Female          74     6     1     6     2
## # … with 40 more rows</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Using everything() within select() means you don&#39;t have to type all the variables out.</span></span></code></pre></div>
</div>
<div id="checking-for-missing-data" class="section level2">
<h2>Checking for missing data</h2>
<p>One problem you may have is missing data. Sometimes this is something you already know about, but you should check your data frame anyway to make sure nothing was missed in a data entry error. For small datasets, you can do this visually, but for larger ones you can ask R.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># This command asks for rows that are not complete. </span></span>
<span id="cb20-2"><a href="#cb20-2"></a>mydata <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">complete.cases</span>(.))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##      ID Condition   Age Sex    Neuroticism  Day1  Day2  Day3  Day4
##   &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1    39         1    NA Female          53     1     3     1     3</code></pre>
<p>In this case, the missing value is the Age value in row 39. You know you have this info somewhere on a paper form, so you go dig it up and want to replace it.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Directly replace a missing value</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>mydata &lt;-<span class="st"> </span>mydata <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Age =</span> <span class="kw">if_else</span>(ID <span class="op">==</span><span class="st"> </span><span class="dv">39</span>, <span class="dv">30</span>, Age))</span></code></pre></div>
</div>
<div id="checking-for-correct-values" class="section level2">
<h2>Checking for correct values</h2>
<p>To look at some of the other variables, let’s use the <code>table()</code> function. This works well for factors or variables with only a few different values. Our condition and sex variables are good here.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Make tables of categorical variables</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="kw">table</span>(mydata<span class="op">$</span>Condition)</span></code></pre></div>
<pre><code>## 
##  0  1 
## 22 28</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">table</span>(mydata<span class="op">$</span>Sex)</span></code></pre></div>
<pre><code>## 
## Female  Femle   Male 
##     21      3     26</code></pre>
<p>When we look at the table for the Sex variable, we see another data entry problem. We have a third category that should really be another case of “Female”. Here we are going to use the function <code>recode</code> from the <code>dplyr</code> package.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Replace bad category label</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>mydata &lt;-<span class="st"> </span>mydata <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Sex =</span> dplyr<span class="op">::</span><span class="kw">recode</span>(Sex, <span class="dt">Femle =</span> <span class="st">&quot;Female&quot;</span>))</span>
<span id="cb27-4"><a href="#cb27-4"></a></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="kw">table</span>(mydata<span class="op">$</span>Sex)</span></code></pre></div>
<pre><code>## 
## Female   Male 
##     24     26</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">table</span>(mydata<span class="op">$</span>Age)</span></code></pre></div>
<pre><code>## 
## 18 19 20 21 22 23 24 25 30 
##  3  5  4 10  6  8  8  5  1</code></pre>
<p>Now let’s look at the continuous variables. You can also look at these with the <code>table()</code> function, but sometimes it’s easier to visualize. The <code>hist()</code> function, which creates histograms, is useful here.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Create histograms to see the data distributions</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="kw">hist</span>(mydata<span class="op">$</span>Age)</span></code></pre></div>
<p><img src="/tutorials/r-core/2-datacleaning/index_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">hist</span>(mydata<span class="op">$</span>Neuroticism)</span></code></pre></div>
<p><img src="/tutorials/r-core/2-datacleaning/index_files/figure-html/unnamed-chunk-12-2.png" width="672" /></p>
<p>Looks like we have a potential outlier on the neuroticism score. This could be an entry error, but it could also be a real value that just happens to be really low. This is why data inspection is so important for later analysis – now that you know that value is there, it’s up to you to decide how to deal with it.</p>
</div>
<div id="filtering-data" class="section level2">
<h2>Filtering data</h2>
<p>Let’s say we have decided a prori to exclude outliers 3SD above or below the mean. We will use the filter() function in <code>tidyverse</code> to clean the dataset.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># mark upper and lower boundaries of data</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co"># anything above upper or below lower will be excluded as outlier.</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>upper &lt;-<span class="st"> </span><span class="kw">mean</span>(mydata<span class="op">$</span>Neuroticism) <span class="op">+</span><span class="st"> </span><span class="dv">3</span><span class="op">*</span><span class="kw">sd</span>(mydata<span class="op">$</span>Neuroticism)</span>
<span id="cb33-4"><a href="#cb33-4"></a>lower &lt;-<span class="st"> </span><span class="kw">mean</span>(mydata<span class="op">$</span>Neuroticism)<span class="op">-</span><span class="st"> </span><span class="dv">3</span><span class="op">*</span><span class="kw">sd</span>(mydata<span class="op">$</span>Neuroticism)</span>
<span id="cb33-5"><a href="#cb33-5"></a></span>
<span id="cb33-6"><a href="#cb33-6"></a>mydata &lt;-<span class="st"> </span>mydata <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="st">  </span><span class="co"># only keep values within this range! </span></span>
<span id="cb33-8"><a href="#cb33-8"></a><span class="st">  </span><span class="kw">filter</span>( Neuroticism <span class="op">&gt;</span><span class="st"> </span>lower <span class="op">&amp;</span><span class="st"> </span>Neuroticism <span class="op">&lt;</span><span class="st"> </span>upper)</span>
<span id="cb33-9"><a href="#cb33-9"></a></span>
<span id="cb33-10"><a href="#cb33-10"></a><span class="co"># check that we excluded 1 outlier. </span></span>
<span id="cb33-11"><a href="#cb33-11"></a><span class="kw">nrow</span>(mydata)</span></code></pre></div>
<pre><code>## [1] 49</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">hist</span>(mydata<span class="op">$</span>Neuroticism)</span></code></pre></div>
<p><img src="/tutorials/r-core/2-datacleaning/index_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
</div>
<div id="getting-ready-for-analysis" class="section level1">
<h1>Getting Ready for Analysis</h1>
<p>Now that we’ve gone through and cleaned up the problems, you can think ahead to how you’ll want to use this data.</p>
<div id="recoding-variables" class="section level2">
<h2>Recoding variables</h2>
<p>Sometimes we want to treat categorical variables as factors, but sometimes we want to pretend they’re numeric (as in a regression, when binary variables can be coded as 0 and 1). Right now, Condition is coded as a binary numeric variable, but that’s not very informative, and you might prefer that the values be descriptive. Here, the function <code>recode()</code> from the <code>dplyr</code> package is really useful again, but we’re going to use a different version that will also turn the variable from numeric into factor data. We’ll also create a second variable instead of overwriting Condition.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Transform into factor with labels using mutate() and recode_factor() </span></span>
<span id="cb36-2"><a href="#cb36-2"></a>mydata &lt;-<span class="st"> </span>mydata <span class="op">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ConditionF =</span> <span class="kw">recode_factor</span>(Condition, <span class="st">&#39;0&#39;</span>=<span class="st">&#39;Control&#39;</span>, <span class="st">&#39;1&#39;</span>=<span class="st">&#39;Treatment&#39;</span>))</span>
<span id="cb36-4"><a href="#cb36-4"></a></span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="co"># Check that your variable is now recoded as you&#39;d like! </span></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="kw">summary</span>(mydata<span class="op">$</span>ConditionF)</span></code></pre></div>
<pre><code>##   Control Treatment 
##        22        27</code></pre>
</div>
<div id="calculating-new-variables" class="section level2">
<h2>Calculating new variables</h2>
<p>You may also want to recalculate or rescale some variables. For example, we can turn Neuroticism into a <em>z</em>-score, or calculate an average response across the four time points. Here we are using <code>mutate()</code>, a dplyr function used for adding new variables to a data frame. Mutate is nice because it makes use of other functions, such as <code>scale()</code> to make <em>z</em>-scores or <code>rowMeans()</code> to calculate means.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># calculate Z scores using mutate()  and scale() </span></span>
<span id="cb38-2"><a href="#cb38-2"></a>mydata &lt;-<span class="st"> </span>mydata <span class="op">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">NeuroticismZ =</span> <span class="kw">scale</span>(Neuroticism, <span class="dt">center =</span> <span class="ot">TRUE</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>),</span>
<span id="cb38-4"><a href="#cb38-4"></a>         <span class="co"># Scale creates a matrix with width 1,</span></span>
<span id="cb38-5"><a href="#cb38-5"></a>         <span class="co"># sometimes this messes things up so we&#39;ll convert it to vector        </span></span>
<span id="cb38-6"><a href="#cb38-6"></a>         <span class="dt">NeuroticismZ =</span> <span class="kw">c</span>(NeuroticismZ))</span>
<span id="cb38-7"><a href="#cb38-7"></a></span>
<span id="cb38-8"><a href="#cb38-8"></a><span class="kw">hist</span>(mydata<span class="op">$</span>NeuroticismZ)</span></code></pre></div>
<p><img src="/tutorials/r-core/2-datacleaning/index_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># calculate means across multiple columns using rowMeans</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="co"># note that cbind is necessary here because rowMeans expects a Matrix</span></span>
<span id="cb39-3"><a href="#cb39-3"></a></span>
<span id="cb39-4"><a href="#cb39-4"></a>mydata &lt;-<span class="st"> </span>mydata <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DayMean =</span> <span class="kw">rowMeans</span>(<span class="kw">cbind</span>(Day1, Day2, Day3, Day4)))</span></code></pre></div>
</div>
<div id="combining-data-from-multiple-sources" class="section level2">
<h2>Combining data from multiple sources</h2>
<p>Sometimes, data might be spread across multiple spreadsheets, and you’ll want to combine those for your analysis. For example, maybe this study had a follow-up survey on Day 30. Scores from that survey were entered into another spreadsheet, which only has the subject ID and that score. We want to include that score into our data.</p>
<p>Although there are many different functions you can use to combine data frames, here I’m using the function <code>inner_join()</code>, which is also part of the <code>tidyverse</code>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># First load the new data</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>mydata2 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">here</span>(<span class="st">&quot;content&quot;</span>, <span class="st">&quot;tutorials&quot;</span>, <span class="st">&quot;r-core&quot;</span>, <span class="st">&quot;2-dataCleaning&quot;</span>, <span class="st">&quot;Study1_Followup.csv&quot;</span>))</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   ID = col_double(),
##   Day30 = col_double()
## )</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># Merge the two data frames. To make sure the rows match up, we use the &#39;by&#39; argument to specify that IDs should match. That way even if the data is in a different order you will get scores matched togther correctly.</span></span>
<span id="cb42-2"><a href="#cb42-2"></a></span>
<span id="cb42-3"><a href="#cb42-3"></a>mydata &lt;-<span class="st"> </span><span class="kw">inner_join</span>(mydata, mydata2, <span class="dt">by =</span> <span class="st">&quot;ID&quot;</span>)</span>
<span id="cb42-4"><a href="#cb42-4"></a></span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="co"># Note that mydata has one less row than mydata2 because we removed that outlier. By default, inner_join will use only cases of the &#39;by&#39; variable that exist in both dataframes, so it drops that one row from mydata2 when merging. You can use other _join functions if you want to keep all observations from one or both frames, even if it means blank cells.</span></span></code></pre></div>
</div>
<div id="reshaping-data" class="section level2">
<h2>Reshaping data</h2>
<p>Finally, you may want to change the layout of your data. Right now, our data frame is in “wide” format, which means that each row is a subject, and each observation gets its own column. For some analyses, you’ll need to use “long” format, where each row is an observation, and columns specify things like time and ID to differentiate the observations. There are lots of packages that can handle data reshaping, but I’ll show the <code>pivot_longer()</code> and <code>pivot_wider()</code> functions from <code>tidyr</code>.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># names_to is the name for the new column that will identify which observation it is</span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="co"># values_to is the name for the new column that will have the actual values in it.</span></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="co"># In theory, you can name these whatever you want,</span></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="co"># but to keep everyone on the same page, name the key &quot;Time&quot; and the value &quot;Score&quot;.</span></span>
<span id="cb43-5"><a href="#cb43-5"></a></span>
<span id="cb43-6"><a href="#cb43-6"></a>mydata_Long &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(mydata, <span class="dt">cols =</span> <span class="kw">starts_with</span>(<span class="st">&quot;Day&quot;</span>),</span>
<span id="cb43-7"><a href="#cb43-7"></a>                            <span class="dt">names_to=</span><span class="st">&quot;Time&quot;</span>, <span class="dt">values_to=</span><span class="st">&quot;Score&quot;</span>)</span>
<span id="cb43-8"><a href="#cb43-8"></a></span>
<span id="cb43-9"><a href="#cb43-9"></a></span>
<span id="cb43-10"><a href="#cb43-10"></a><span class="co"># pivot_wider() lets you go back the other direction.</span></span>
<span id="cb43-11"><a href="#cb43-11"></a><span class="co"># This should be identical to the original mydata.</span></span>
<span id="cb43-12"><a href="#cb43-12"></a></span>
<span id="cb43-13"><a href="#cb43-13"></a>mydata_Wide &lt;-<span class="st"> </span><span class="kw">pivot_wider</span>(mydata_Long,</span>
<span id="cb43-14"><a href="#cb43-14"></a>                           <span class="dt">id_cols =</span> <span class="kw">c</span>(ID, Age, Sex, Condition, Neuroticism),</span>
<span id="cb43-15"><a href="#cb43-15"></a>                           <span class="dt">names_from =</span> Time, <span class="dt">values_from =</span> Score)</span></code></pre></div>
</div>
</div>
<div id="saving-your-work" class="section level1">
<h1>Saving Your Work</h1>
<p>Once you’ve created a data cleaning script like this one, you’ll have a record of all the edits you’ve made on the raw data, and you can recreate your cleaned data just by running the script again. However, it’s often easier to save your cleaned data as its own file <strong>(never overwrite the raw data)</strong>, so when you come back to do analysis you don’t have to bother with all the cleaning steps.</p>
<p>You can always save data frames as a .csv for easy sharing and viewing outside of R.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># Write data to a .csv</span></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="kw">write_csv</span>(mydata, <span class="dt">path =</span> <span class="kw">here</span>(<span class="st">&quot;content&quot;</span>, <span class="st">&quot;tutorials&quot;</span>, <span class="st">&quot;r-core&quot;</span>, <span class="st">&quot;2-dataCleaning&quot;</span>, <span class="st">&quot;Study1_Clean.csv&quot;</span>))</span></code></pre></div>
<p>However, you can also save in an R format that lets you save multiple variables/objects in the same file. For example, you might want to have a long and wide format, or one dataframe with all the data and one with just subject information. Saving as a .rda file allows you to save multiple objects at once for easy loading into R. You can also save the outputs of statistical models in these, along with their data.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># Save a .rda. Add as many objects as you want, separated by commas</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="kw">save</span>(mydata_Long, mydata_Wide, <span class="dt">file =</span> <span class="kw">here</span>(<span class="st">&quot;content&quot;</span>, <span class="st">&quot;tutorials&quot;</span>, <span class="st">&quot;r-core&quot;</span>, <span class="st">&quot;2-dataCleaning&quot;</span>,  <span class="st">&quot;Study1_clean.rda&quot;</span>))</span></code></pre></div>
<!-- CUT FOR NOW
## Data Challenge!

Go to the file [CleaningChallenge_NoCode.Rmd](2-dataCleaning/CleaningChallenge_NoCode.Rmd) for your data challenge. This challenge will include skills from this tutorial, but it will also ask you to explore new functions we didn't cover. Remember to use the help command in R (?<function name>) and google as necessary. You'll also be using three files from "Study 2", so make sure they're in your folder: [README_Study2.txt](2-dataCleaning/README_Study2.txt), [Study2_Subjects.csv](2-dataCleaning/Study2_Subjects.csv), and [Study2_Trials.csv](2-dataCleaning/Study2_Trials.csv).
-->
</div>
<div id="future-directions" class="section level1">
<h1>Future Directions</h1>
<p>Congratulations! You’ve now cleaned some data in R and you’re ready to start working with your data. This tutorial only went over some basic cleaning steps. As you work with your own data, you may find yourself needing other tools.</p>
<p><strong>Next:</strong> <a href="/tutorials/r-core/3-datamanipulation/">Data Manipulation (Grouping, categorizing, and descriptive statistics)</a></p>
</div>
